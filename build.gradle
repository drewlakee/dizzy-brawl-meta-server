plugins {
    id 'java'
    id "io.vertx.vertx-plugin" version "1.1.2"
}

group 'org.dizzybrawl'
version '1.0'

repositories {
    mavenCentral()
}

java {
    sourceCompatibility = JavaVersion.VERSION_14
    targetCompatibility = JavaVersion.VERSION_14
}

dependencies {
    compile 'io.vertx:vertx-core:3.9.3'
    compile 'io.vertx:vertx-web:3.9.3'
    compile 'io.vertx:vertx-codegen:3.9.3'
    compile 'io.vertx:vertx-service-proxy:3.9.3'
    compile 'io.vertx:vertx-pg-client:3.9.3'
    compile 'com.ongres.scram:client:2.1'

    testCompile group: 'junit', name: 'junit', version: '4.11'
    testCompile group: 'junit', name: 'junit', version: '4.12'

    annotationProcessor 'io.vertx:vertx-codegen:3.9.3'
    annotationProcessor 'io.vertx:vertx-service-proxy:3.9.3'
}

vertx {
    mainVerticle = 'dizzybrawl.MainVerticle'
}

sourceSets {
    generated{
        java.srcDir "${projectDir}/src/generated/java"
    }
}

task generateProxies(type: JavaCompile) {
    group 'build'
    description 'Generates the Vert.x proxies'
    source = sourceSets.main.java
    classpath = configurations.compile + configurations.compileOnly
    options.annotationProcessorPath = configurations.annotationProcessor
    options.compilerArgs = [
            "-proc:only",
            "-processor", "io.vertx.codegen.CodeGenProcessor",
            "-Acodegen.output=${projectDir}/src/main"
    ]
    destinationDir = file("${projectDir}/src/generated/java")
}

compileJava{
    dependsOn generateProxies
    source += sourceSets.generated.java
    options.compilerArgs += '-proc:none'
}

clean {
    delete += sourceSets.generated.java.srcDirs
}
